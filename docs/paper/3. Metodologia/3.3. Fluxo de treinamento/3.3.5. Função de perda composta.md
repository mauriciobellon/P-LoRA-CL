# 3.3.5. Função de perda composta

A função de perda total durante o treinamento da tarefa T_k é uma combinação ponderada de múltiplos termos:

L_total = L_task + λ_ortho L_ortho + λ_ewc L_ewc

onde:
- L_task é a perda padrão da tarefa (cross-entropy para classificação) sobre os dados reais e sintéticos de T_k
- L_ortho é o termo de ortogonalidade que penaliza projeções dos novos adaptadores nos subespaços dos adaptadores anteriores
- L_ewc é o termo de penalização EWC que protege pesos críticos identificados por Fisher
- λ_ortho e λ_ewc são hiperparâmetros que controlam a força de cada regularização

A perda sobre exemplos sintéticos de tarefas anteriores também contribui para L_task, reforçando conhecimentos passados enquanto aprendemos a nova tarefa.

Instanciação dos termos:
- L_task: cross-entropy padrão; quando aplicável, ponderada por classe; inclui exemplos reais de T_k e sintéticos de T_{<k}.
- L_ortho: soma das normas das projeções de colunas de A_k no span das bases A_{<k} (ou penalização por cosseno). Implementamos uma versão diferenciável e eficiente por camada.
- L_ewc: λ Σ_j 0.5 F_j (θ_j − θ*_j)² sobre pesos parcialmente destravados; Online EWC com decaimento.

Usamos um scheduler para λ_ortho (cresce ao longo do treino) e λ_ewc (constante por tarefa), calibrados em validação. Essa combinação preserva plasticidade no início e endurece restrições rumo à convergência.
